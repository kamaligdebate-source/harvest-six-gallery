<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholars Gallery | Harvest Six</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ¾</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --harvest-green: #7d8c6b; 
            --dark-olive: #3d3d35;
            --cream-bg: #f7f5ed; 
            --card-paper: #ffffff;
            --text-main: #4a4a40;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: var(--cream-bg); 
            margin: 0; padding: 0; 
            color: var(--text-main); 
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Paper texture background */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
            opacity: 0.4; pointer-events: none; z-index: 1;
        }

        header { 
            padding: 80px 20px 30px;
            text-align: center; position: relative; z-index: 2;
        }
        .header-title { 
            font-family: 'Fredoka', sans-serif; 
            font-size: clamp(2.5rem, 8vw, 4rem); 
            color: var(--dark-olive); margin: 0; letter-spacing: -1px;
        }

        /* FIXED HEADER DEPTH */
        .sticky-controls { 
            position: sticky; top: 0; z-index: 9999; /* Ensure it stays on top of everything */
            background: rgba(247, 245, 237, 0.9); backdrop-filter: blur(15px);
            padding: 15px 10px; border-bottom: 1px solid rgba(125, 140, 107, 0.1);
        }

        .nav-container { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
        .nav-btn { 
            font-size: 10px; text-transform: uppercase; font-weight: 700;
            padding: 6px 14px; border: 1.5px solid var(--harvest-green);
            color: var(--harvest-green); text-decoration: none; border-radius: 20px;
            transition: 0.2s; background: transparent; letter-spacing: 1px;
        }
        .nav-btn:hover { background: var(--harvest-green); color: white; }

        #scholarSearch { 
            width: 90%; max-width: 350px; padding: 10px 20px; 
            border: 1px solid rgba(0,0,0,0.08); border-radius: 25px;
            font-family: 'Quicksand', sans-serif; outline: none;
            background: var(--card-paper); font-size: 14px;
        }

        /* FLOAT GARDEN */
        #grainGardenContainer {
            position: fixed; bottom: 20px; left: 20px; z-index: 4000;
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px);
            border-radius: 15px; border: 1px solid rgba(0,0,0,0.05);
            padding: 10px; width: 140px; text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.06);
        }
        #gardenCanvas { width: 100%; height: 60px; border-radius: 8px; }

        .cohort-section { padding: 30px 5%; max-width: 1200px; margin: 0 auto; }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }

        /* SHORT & PRETTY CARDS */
        .scholar-card { 
            background: var(--card-paper); padding: 30px 20px; border-radius: 12px;
            text-align: center; position: relative; opacity: 0; 
            transform: translateY(20px); transition: all 0.5s ease-out;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02); border: 1px solid rgba(0,0,0,0.03);
            z-index: 10;
        }
        .scholar-card.sprouted { opacity: 1; transform: translateY(0); }
        .scholar-card:hover { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0,0,0,0.08); z-index: 50; }

        .break-badge { 
            position: absolute; top: 12px; left: 12px; font-size: 9px; font-weight: 700; 
            color: #fff; background: var(--harvest-green); 
            padding: 4px 10px; border-radius: 6px; cursor: pointer;
        }

        /* POPUP LOG */
        .harvest-log-container {
            position: absolute; top: 35px; left: 0; width: 280px;
            background: #fff; padding: 20px; border-radius: 10px;
            border: 1px solid #eee; text-align: left; 
            z-index: 1000; opacity: 0; visibility: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
            transition: 0.2s; pointer-events: none;
        }
        .break-badge:hover .harvest-log-container { opacity: 1; visibility: visible; pointer-events: auto; }

        .name { font-family: 'Fredoka', sans-serif; font-size: 1.2rem; color: var(--dark-olive); margin: 5px 0; }
        .inst { font-size: 8px; color: #999; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 700; display: block; margin-bottom: 15px; }
        .accolade-box { font-size: 11px; color: #777; border-top: 1px solid #f9f9f9; padding-top: 12px; font-style: italic; }

        .ver-stamp { position: fixed; bottom: 8px; right: 8px; font-size: 7px; opacity: 0.2; z-index: 9999; }

        /* MOBILE OVERRIDES */
        @media (max-width: 600px) {
            #grainGardenContainer { bottom: auto; top: 12px; right: 12px; left: auto; width: 85px; padding: 5px; }
            #gardenCanvas { height: 35px; }
            #totalBreaks { font-size: 16px !important; }
            .grid { grid-template-columns: 1fr; }
            .harvest-log-container { width: 240px; left: 0; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        }
    </style>
</head>
<body>

<header>
    <h1 class="header-title">Harvest Six</h1>
    <div style="font-size: 10px; text-transform: uppercase; letter-spacing: 3px; color: var(--harvest-green); font-weight: 600; margin-top: 5px;">Scholars Gallery</div>
</header>

<div class="sticky-controls">
    <div class="nav-container" id="batchNav"></div>
    <div style="text-align: center;">
        <input type="text" id="scholarSearch" placeholder="Search the archives...">
    </div>
</div>

<div id="gallery"></div>

<div id="grainGardenContainer">
    <canvas id="gardenCanvas"></canvas>
    <div style="font-size: 18px; font-weight: 700; color: var(--dark-olive); font-family: 'Fredoka';" id="totalBreaks">0</div>
    <div style="font-size: 7px; text-transform: uppercase; color: var(--harvest-green); letter-spacing: 1px;">Yield</div>
</div>

<div class="ver-stamp">H6-C12</div>

<script>
    const gardenCanvas = document.getElementById('gardenCanvas');
    const gCtx = gardenCanvas.getContext('2d');
    let grainArray = [];

    function animate() {
        gCtx.clearRect(0, 0, gardenCanvas.width, gardenCanvas.height);
        const sunX = (Date.now() * 0.004) % (gardenCanvas.width + 40) - 20;
        gCtx.font = '16px serif';
        gCtx.fillText('â˜€ï¸', sunX, 18);

        gCtx.font = '22px serif';
        grainArray.forEach(g => {
            const sway = Math.sin(Date.now() * 0.002 + g.offset) * 6;
            gCtx.save();
            gCtx.translate(g.x, gardenCanvas.height - 5);
            gCtx.rotate(sway * Math.PI / 180);
            gCtx.fillText('ðŸŒ¾', -11, 0);
            gCtx.restore();
        });
        requestAnimationFrame(animate);
    }

    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHPJe3Zt0F1OO2gt1igtfKLmt4QdMedmq7qI3wn769I-lpWA0aMZ9I07v1DwJgdCuDz2i3t2wPyfmt/pub?output=csv';

    async function loadData() {
        try {
            const res = await fetch(sheetUrl);
            const text = await res.text();
            const rows = text.split('\n').slice(1);
            
            const data = rows.map(row => {
                const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    name: c[0]?.replace(/"/g, '').trim(),
                    batch: c[1]?.trim(),
                    accolade: c[2]?.replace(/"/g, '').trim(),
                    batchName: c[3]?.trim(),
                    inst: c[5]?.replace(/"/g, '').trim(),
                    breaks: parseInt(c[6]) || 0,
                    tourneys: c[7]?.replace(/"/g, '') || ""
                };
            }).filter(d => d.name);

            render(data);
        } catch(e) { console.error(e); }
    }

    function render(data) {
        const gal = document.getElementById('gallery');
        const nav = document.getElementById('batchNav');
        document.getElementById('totalBreaks').innerText = data.reduce((s, i) => s + i.breaks, 0);

        grainArray = Array.from({ length: 10 }, () => ({
            x: Math.random() * (gardenCanvas.width - 25) + 12,
            offset: Math.random() * 100
        }));

        const batches = [...new Set(data.map(d => d.batch))].sort();
        batches.forEach(bNum => {
            const bItems = data.filter(d => d.batch === bNum);
            nav.innerHTML += `<a href="#batch-${bNum}" class="nav-btn">${bItems[0].batchName || bNum}</a>`;
            
            const section = document.createElement('section');
            section.className = 'cohort-section';
            section.id = `batch-${bNum}`;
            section.innerHTML = `<div class="grid"></div>`;
            const grid = section.querySelector('.grid');

            bItems.forEach(item => {
                const tourneyList = item.tourneys.split(/\\n|,/).map(t => {
                    const clean = t.trim().replace(/(\|\||\*\*\*|\*\*|\*)/g, '');
                    return t.trim() ? `<li>${clean}</li>` : '';
                }).join('');

                grid.innerHTML += `
                    <div class="scholar-card">
                        ${item.breaks > 0 ? `
                        <div class="break-badge">${item.breaks} Breaks
                            <div class="harvest-log-container">
                                <ul style="list-style:none; padding:0; font-size:11px; color:#666;">${tourneyList}</ul>
                            </div>
                        </div>` : ''}
                        <div style="font-size:28px; margin-bottom:8px;">${item.breaks > 10 ? 'ðŸ¯' : (item.breaks > 0 ? 'ðŸŒ¾' : 'ðŸŒ±')}</div>
                        <div class="name">${item.name}</div>
                        <div class="inst">${item.inst}</div>
                        <div class="accolade-box">${item.accolade}</div>
                    </div>`;
            });
            gal.appendChild(section);
        });

        const observer = new IntersectionObserver(es => {
            es.forEach(e => { if(e.isIntersecting) e.target.classList.add('sprouted'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.scholar-card').forEach(c => observer.observe(c));
    }

    document.getElementById('scholarSearch').addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll('.scholar-card').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(val) ? 'block' : 'none';
        });
    });

    animate(); loadData();
</script>
</body>
</html>
