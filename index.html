<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholars Gallery | Harvest Six</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåæ</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --harvest-green: #6d8c54; 
            --dark-olive: #4a5d3a;
            --cream-bg: #e5e4c5; 
            --text-main: #5a6650;
            --blob-color: rgba(109, 140, 84, 0.08);
            --gold: #b8860b;
            --regional-blue: #4682b4;
            --champ-red: #a63d40;
            --paper-shadow: 0 10px 30px rgba(90, 102, 80, 0.08);
        }

        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: var(--cream-bg); 
            margin: 0; padding: 0; 
            color: var(--text-main); 
            background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* --- ORGANIC HEADER --- */
        header { 
            padding: 100px 20px 60px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; text-align: center;
        }
        header::before {
            content: ""; position: absolute; z-index: -1;
            background: var(--blob-color); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            width: 450px; height: 450px; top: -100px; left: -150px;
            animation: morph 20s linear infinite alternate;
        }
        @keyframes morph {
            from { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
            to { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
        }

        .header-title { 
            font-family: 'Fredoka', sans-serif; 
            font-size: clamp(3rem, 10vw, 4.5rem); 
            color: var(--harvest-green); 
            margin: 0; font-weight: 700;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
        }

        #topHarvesterCycle { margin-top: 25px; min-height: 24px; }
        #leaderName { 
            font-weight: 700; font-size: 12px; color: var(--dark-olive); 
            text-transform: uppercase; letter-spacing: 2px;
            background: rgba(255,255,255,0.4); padding: 6px 15px; border-radius: 50px;
        }

        .population-box { margin-top: 35px; }
        .goal-bar-bg { width: 300px; height: 10px; background: rgba(0,0,0,0.05); border-radius: 20px; margin: 12px auto; overflow: hidden; border: 1px solid rgba(255,255,255,0.3); }
        #goalProgress { background: linear-gradient(90deg, var(--harvest-green), #8da878); width: 0%; height: 100%; border-radius: 20px; transition: 2s cubic-bezier(0.2, 1, 0.3, 1); }
        .counter-text { font-size: 10px; font-weight: 700; color: var(--dark-olive); text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.8; }

        /* --- FROSTED STICKY NAV --- */
        .sticky-controls { 
            position: sticky; top: 0; z-index: 200; 
            background: rgba(229, 228, 197, 0.8); backdrop-filter: blur(15px);
            padding: 20px 0; border-bottom: 1px solid rgba(109, 140, 84, 0.1); text-align: center;
        }
        .nav-btn { 
            font-family: 'Fredoka', sans-serif; font-size: 11px; text-transform: uppercase; 
            padding: 10px 22px; border: 1.5px solid var(--harvest-green); border-radius: 50px; 
            cursor: pointer; color: var(--harvest-green); text-decoration: none; font-weight: 600; margin: 0 6px;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: inline-block;
            background: transparent;
        }
        .nav-btn:hover { background: var(--harvest-green); color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(109, 140, 84, 0.2); }
        
        #scholarSearch { 
            margin-top: 20px; width: 320px; padding: 14px 28px; 
            border: 1.5px solid rgba(109, 140, 84, 0.2); border-radius: 50px; 
            font-family: 'Quicksand', sans-serif; outline: none; background: rgba(252, 252, 247, 0.8);
            transition: 0.3s ease; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        #scholarSearch:focus { border-color: var(--harvest-green); background: #fff; width: 350px; }

        /* --- REFINED GARDEN PLANTER --- */
        #grainGardenContainer {
            position: fixed; bottom: 30px; left: 30px; z-index: 1000;
            background: #fff; border-radius: 20px; padding: 18px;
            box-shadow: var(--paper-shadow); width: 140px; text-align: center;
            border: 1px solid #eeeae0;
        }
        #gardenBed { 
            height: 80px; position: relative; overflow: hidden; border-radius: 12px; 
            background: #f4f3e9; margin-bottom: 10px; border: 1px inset rgba(0,0,0,0.03); 
        }

        /* --- REFINED GRID & CARDS --- */
        .cohort-section { padding: 60px 10% 40px; }
        .cohort-title { font-family: 'Fredoka', sans-serif; font-size: 26px; color: var(--harvest-green); text-align: center; margin-bottom: 50px; position: relative; }
        .cohort-title::after { content: ""; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: 3px; background: var(--blob-color); border-radius: 50px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 40px; }

        .scholar-card { 
            display: flex; flex-direction: column; background: white; padding: 55px 30px 35px; 
            border-radius: 35px 25px 40px 30px;
            text-align: center; position: relative; opacity: 0; transform: translateY(30px);
            box-shadow: var(--paper-shadow); transition: 0.8s cubic-bezier(0.2, 1, 0.3, 1);
            height: 100%; box-sizing: border-box;
        }
        .scholar-card.sprouted { opacity: 1; transform: translateY(0); }
        .scholar-card:hover { transform: translateY(-8px) rotate(0.5deg); box-shadow: 0 20px 40px rgba(90, 102, 80, 0.12); }

        .scholar-card::before {
            content: ""; position: absolute; top: -10px; left: 50%; transform: translateX(-50%) rotate(-2deg);
            width: 85px; height: 28px; background: rgba(109, 140, 84, 0.15); 
            border-radius: 2px; z-index: 5; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .break-badge { 
            position: absolute; top: 22px; left: 25px; font-size: 10px; font-weight: 700; 
            color: var(--harvest-green); background: #f4f7f0; padding: 5px 14px; border-radius: 50px; 
            cursor: pointer; z-index: 20; border: 1px solid rgba(109, 140, 84, 0.1);
        }

        /* HARVEST LOG REFINEMENT */
        .harvest-log-container {
            position: absolute; top: 45px; left: 0; width: 260px;
            background: white; border-radius: 20px; padding: 20px;
            box-shadow: 0 15px 45px rgba(0,0,0,0.12); border: 1px solid #f0f0f0;
            text-align: left; z-index: 100; opacity: 0; visibility: hidden; transform: translateY(-10px);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); pointer-events: none;
            max-height: 250px; overflow-y: auto;
        }
        .break-badge:hover .harvest-log-container { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }

        .log-title { font-family: 'Fredoka', sans-serif; font-size: 11px; text-transform: uppercase; color: var(--harvest-green); border-bottom: 1px solid #f8f8f8; padding-bottom: 8px; margin-bottom: 12px; display: block; letter-spacing: 1px; }
        .tournament-list { margin: 0; padding: 0; list-style: none; font-size: 11px; color: #6e7a63; line-height: 1.6; }
        .tournament-list li { margin-bottom: 8px; padding-left: 20px; position: relative; }
        
        /* New Prestigious Tier Styles */
        .tournament-list li::before { content: "‚Ä¢"; position: absolute; left: 0; color: #cbd6c2; font-size: 14px; line-height: 1; }
        
        /* Tier 1: Championship (***) */
        .tournament-list li.prestige-championship { color: var(--champ-red); font-weight: 700; }
        .tournament-list li.prestige-championship::before { content: "üèÜ"; font-size: 10px; left: -2px; color: var(--champ-red); }

        /* Tier 2: National (**) */
        .tournament-list li.prestige-national { color: var(--gold); font-weight: 700; }
        .tournament-list li.prestige-national::before { content: "‚≠ê"; font-size: 10px; left: -2px; color: var(--gold); }

        /* Tier 3: Regional (*) */
        .tournament-list li.prestige-regional { color: var(--regional-blue); font-weight: 600; }
        .tournament-list li.prestige-regional::before { content: "üìç"; font-size: 10px; left: -2px; color: var(--regional-blue); }

        .name { font-family: 'Fredoka', sans-serif; font-weight: 600; color: var(--dark-olive); font-size: 1.25rem; margin-top: 5px; }
        .inst { font-size: 10px; color: #9da892; text-transform: uppercase; font-weight: 700; margin-bottom: 18px; display: block; letter-spacing: 0.5px; }
        .accolade-box { font-size: 11.5px; color: #7a8570; margin-top: auto; padding-top: 15px; font-style: italic; border-top: 1px solid #fbfbf7; }

        footer { text-align: center; padding: 100px 20px; opacity: 0.6; }
    </style>
</head>
<body>

<header>
    <div class="header-subtitle" style="font-family: 'Fredoka'; font-size: 12px; text-transform: uppercase; letter-spacing: 4px; margin-bottom: 10px; opacity: 0.6;">Kamalig Mentorship</div>
    <h1 class="header-title">Harvest Six</h1>
    <div id="topHarvesterCycle"><span id="leaderName">Cultivating Growth...</span></div>
    
    <div class="population-box">
        <div class="counter-text">Batch Population: <span id="countDisplay">0</span> / 100</div>
        <div class="goal-bar-bg"><div id="goalProgress"></div></div>
    </div>
</header>

<div class="sticky-controls">
    <div id="batchNav"></div>
    <input type="text" id="scholarSearch" placeholder="Search a scholar or institution..." onkeyup="searchScholars()">
</div>

<div id="grainGardenContainer">
    <div id="gardenBed"><div style="position:absolute; top:5px; right:8px; font-size:20px;">‚òÄÔ∏è</div></div>
    <div style="font-size: 20px; font-weight: 700; color: var(--harvest-green); font-family: 'Fredoka';" id="totalBreaks">0</div>
    <div style="font-size: 9px; text-transform: uppercase; color: #abb5a1; letter-spacing: 2px; font-weight: 700;">Total Yield</div>
</div>

<div id="gallery"></div>

<footer>
    <a href="https://forms.gle/EQ8bFb1KJLaew9vX7" target="_blank" style="color: var(--harvest-green); font-family: 'Fredoka'; font-size: 11px; font-weight: 700; text-decoration: none; text-transform: uppercase; letter-spacing: 3px; border-bottom: 1px solid rgba(109,140,84,0.3); padding-bottom: 4px;">Update Scholar Profile</a>
</footer>

<script>
    function parseFullCSV(data) {
        const result = [];
        let row = [''];
        let i = 0;
        let inQuotes = false;
        for (let j = 0; j < data.length; j++) {
            const char = data[j];
            const nextChar = data[j+1];
            if (char === '"' && inQuotes && nextChar === '"') { row[i] += '"'; j++; }
            else if (char === '"') { inQuotes = !inQuotes; }
            else if (char === ',' && !inQuotes) { row[++i] = ''; }
            else if ((char === '\n' || char === '\r') && !inQuotes) {
                if (row.length > 1 || row[0] !== '') result.push(row);
                row = ['']; i = 0;
                if (char === '\r' && nextChar === '\n') j++;
            } else { row[i] += char; }
        }
        if (row.length > 1 || row[0] !== '') result.push(row);
        return result;
    }

    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHPJe3Zt0F1OO2gt1igtfKLmt4QdMedmq7qI3wn769I-lpWA0aMZ9I07v1DwJgdCuDz2i3t2wPyfmt/pub?output=csv';
    let allData = [];
    let leaders = [];
    let lIdx = 0;

    async function loadGallery() {
        try {
            const res = await fetch(sheetUrl);
            const rawCsv = await res.text();
            const allRows = parseFullCSV(rawCsv.trim()).slice(1);
            allData = allRows.map(c => {
                if (!c[0]) return null;
                return { name: c[0].trim(), batchNum: c[1].trim(), accolade: c[2].trim(), batchName: c[3].trim(), institution: c[5].trim(), breaks: parseInt(c[6]) || 0, tournaments: c[7] ? c[7].trim() : "" };
            }).filter(i => i !== null);
            render();
        } catch (e) { console.error(e); }
    }

    function render() {
        const gal = document.getElementById('gallery');
        const nav = document.getElementById('batchNav');
        const bed = document.getElementById('gardenBed');
        gal.innerHTML = ""; nav.innerHTML = ""; bed.innerHTML = '<div style="position:absolute; top:5px; right:8px; font-size:20px;">‚òÄÔ∏è</div>';

        document.getElementById('countDisplay').innerText = allData.length;
        document.getElementById('goalProgress').style.width = Math.min(allData.length, 100) + "%";
        const totalBreaks = allData.reduce((s, i) => s + i.breaks, 0);
        document.getElementById('totalBreaks').innerText = totalBreaks;

        for(let i=0; i < Math.floor(totalBreaks / 5); i++) {
            const g = document.createElement('span'); g.className = 'garden-item'; g.innerHTML = 'üåæ';
            g.style.left = Math.random() * 85 + "%"; g.style.fontSize = (16 + Math.random() * 8) + "px";
            g.style.animationDelay = (Math.random() * 2) + "s";
            bed.appendChild(g);
        }

        const batches = [...new Set(allData.map(i => i.batchNum))].sort((a,b) => a-b);
        batches.forEach(bNum => {
            const bItems = allData.filter(i => i.batchNum === bNum);
            const bName = bItems[0].batchName || `Batch ${bNum}`;
            const bID = `batch-${bNum}`;
            nav.innerHTML += `<a href="#${bID}" class="nav-btn">${bName}</a>`;
            const section = document.createElement('div');
            section.className = 'cohort-section'; section.id = bID;
            section.innerHTML = `<div class="cohort-title">üåæ ${bName} üåæ</div><div class="grid"></div>`;
            const grid = section.querySelector('.grid');
            
            bItems.forEach((item) => {
                let tourneyItems = "";
                if (item.tournaments) {
                    const rawList = item.tournaments.split(/\r?\n|,/).filter(t => t.trim() !== "");
                    
                    // NEW PRESTIGE LOGIC
                    tourneyItems = rawList.map(t => {
                        const raw = t.trim();
                        let prestigeClass = "";
                        let cleanName = raw;

                        if (raw.startsWith('***') && raw.endsWith('***')) {
                            prestigeClass = "prestige-championship";
                            cleanName = raw.substring(3, raw.length - 3);
                        } else if (raw.startsWith('**') && raw.endsWith('**')) {
                            prestigeClass = "prestige-national";
                            cleanName = raw.substring(2, raw.length - 2);
                        } else if (raw.startsWith('*') && raw.endsWith('*')) {
                            prestigeClass = "prestige-regional";
                            cleanName = raw.substring(1, raw.length - 1);
                        }

                        return `<li class="${prestigeClass}">${cleanName}</li>`;
                    }).join('');
                }

                const card = document.createElement('div');
                card.className = 'scholar-card';
                card.innerHTML = `
                    ${item.breaks > 0 ? `<div class="break-badge">${item.breaks} Breaks 
                        <div class="harvest-log-container"><span class="log-title">Harvest Log</span><ul class="tournament-list">${tourneyItems}</ul></div>
                    </div>` : ''}
                    <div style="font-size:36px; margin-bottom:12px;">${item.breaks > 0 ? 'üåæ' : 'üå±'}</div>
                    <span class="name">${item.name}</span>
                    <span class="inst">${item.institution}</span>
                    <div class="accolade-box">${item.accolade}</div>
                `;
                grid.appendChild(card);
            });
            gal.appendChild(section);
        });

        setTimeout(() => {
            const obs = new IntersectionObserver((es) => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('sprouted') }), {threshold:0.1});
            document.querySelectorAll('.scholar-card').forEach(c => obs.observe(c));
        }, 100);
        const maxB = Math.max(...allData.map(x => x.breaks));
        leaders = allData.filter(s => s.breaks === maxB && maxB > 0);
        if(leaders.length) startLeaderCycle();
    }

    function startLeaderCycle() {
        const el = document.getElementById('leaderName');
        const cycle = () => {
            el.classList.add('fade-out');
            setTimeout(() => {
                lIdx = (lIdx + 1) % leaders.length;
                el.innerText = `Top Harvest: ${leaders[lIdx].name} (${leaders[lIdx].breaks} Breaks)`;
                el.classList.remove('fade-out');
            }, 1200); 
        };
        setInterval(cycle, 5500);
        el.innerText = `Top Harvest: ${leaders[0].name} (${leaders[0].breaks} Breaks)`;
    }

    function searchScholars() {
        const searchT = document.getElementById('scholarSearch').value.toLowerCase();
        document.querySelectorAll('.scholar-card').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(searchT) ? 'flex' : 'none';
        });
        document.querySelectorAll('.cohort-section').forEach(section => {
            section.style.display = Array.from(section.querySelectorAll('.scholar-card')).some(card => card.style.display !== 'none') ? 'block' : 'none';
        });
    }

    loadGallery();
</script>
</body>
</html>
