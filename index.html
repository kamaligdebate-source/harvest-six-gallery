<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholars Gallery | Harvest Six</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ¾</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --harvest-green: #6d8c54; 
            --dark-olive: #4a5d3a;
            --cream-bg: #e5e4c5; 
            --text-main: #5a6650;
            --blob-color: rgba(109, 140, 84, 0.12);
        }

        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: var(--cream-bg); 
            margin: 0; padding: 0; 
            color: var(--text-main); 
            background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
            overflow-x: hidden;
        }

        header { 
            padding: 80px 20px 40px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; text-align: center;
        }

        .header-title { font-family: 'Fredoka', sans-serif; font-size: clamp(2.5rem, 8vw, 3.8rem); color: var(--harvest-green); margin: 0; font-weight: 700; }

        #topHarvesterCycle { margin-top: 25px; min-height: 24px; }
        #leaderName { font-weight: 700; font-size: 13px; color: var(--harvest-green); text-transform: uppercase; letter-spacing: 1.5px; transition: opacity 1.2s; }
        .fade-out { opacity: 0 !important; }

        .sticky-controls { 
            position: sticky; top: 0; z-index: 200; 
            background: rgba(229, 228, 197, 0.92); backdrop-filter: blur(12px);
            padding: 15px 0; border-bottom: 2px solid rgba(109, 140, 84, 0.15); text-align: center;
        }
        .nav-btn { 
            font-family: 'Fredoka', sans-serif; font-size: 10px; text-transform: uppercase; 
            padding: 8px 18px; border: 2px solid var(--harvest-green); border-radius: 50px; 
            cursor: pointer; color: var(--harvest-green); text-decoration: none; font-weight: 600; margin: 0 4px;
            transition: 0.3s; display: inline-block;
        }
        
        #scholarSearch { 
            margin-top: 15px; width: 250px; padding: 12px 25px; 
            border: 2px solid rgba(109, 140, 84, 0.2); border-radius: 50px; 
            font-family: 'Quicksand', sans-serif; outline: none; background: #fcfcf7;
        }

        .cohort-section { padding: 40px 8% 20px; }
        .cohort-title { font-family: 'Fredoka', sans-serif; font-size: 22px; color: var(--harvest-green); text-align: center; margin-bottom: 40px; }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; }
        @media (max-width: 1200px) { .grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 900px) { .grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 550px) { .grid { grid-template-columns: 1fr; } }

        .scholar-card { 
            display: flex; flex-direction: column; background: white; padding: 50px 20px 30px; border-radius: 30px;
            text-align: center; position: relative; opacity: 0; transform: translateY(20px);
            box-shadow: 0 8px 20px rgba(90, 102, 80, 0.05); transition: 0.6s cubic-bezier(0.2, 1, 0.3, 1);
            height: 100%; box-sizing: border-box;
        }
        .scholar-card.sprouted { opacity: 1; transform: translateY(0); }

        .break-badge { 
            position: absolute; top: 18px; left: 22px; font-size: 10px; font-weight: 700; 
            color: var(--harvest-green); background: #f4f7f0; padding: 4px 12px; border-radius: 20px; 
            display: flex; align-items: center; gap: 5px; cursor: help; z-index: 10;
        }

        /* --- HOVER DROPDOWN --- */
        .harvest-dropdown {
            position: absolute; top: 35px; left: 0; width: 230px;
            background: white; border-radius: 15px; padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 1px solid #eee;
            text-align: left; z-index: 100;
            opacity: 0; visibility: hidden; transform: translateY(-10px);
            transition: 0.3s ease; pointer-events: none;
            max-height: 200px; overflow-y: auto;
        }
        .break-badge:hover .harvest-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }

        .dropdown-title { font-family: 'Fredoka', sans-serif; font-size: 11px; text-transform: uppercase; color: var(--harvest-green); border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; margin-bottom: 8px; display: block; }
        .tournament-list { margin: 0; padding: 0; list-style: none; font-size: 10.5px; color: #666; line-height: 1.4; }
        .tournament-list li { margin-bottom: 6px; padding-left: 12px; position: relative; }
        .tournament-list li::before { content: "â€¢"; position: absolute; left: 0; color: var(--harvest-green); font-weight: bold; }

        .name { font-family: 'Fredoka', sans-serif; font-weight: 600; color: var(--dark-olive); font-size: 1.15rem; margin-top: 15px; }
        .inst { font-size: 10px; color: #99a38f; text-transform: uppercase; font-weight: 700; margin-bottom: 15px; }
        .accolade-box { font-size: 11px; color: #777; margin-top: auto; border-top: 1px solid #f8f8f8; padding-top: 12px; font-style: italic; }

        footer { text-align: center; padding: 80px 20px; }
    </style>
</head>
<body>

<header>
    <div class="header-subtitle">Kamalig Debate Mentorship Program</div>
    <h1 class="header-title">Harvest Six</h1>
    <div id="topHarvesterCycle"><span id="leaderName">Loading Harvest...</span></div>
</header>

<div class="sticky-controls">
    <div id="batchNav"></div>
    <input type="text" id="scholarSearch" placeholder="Search name or school..." onkeyup="searchScholars()">
</div>

<div id="gallery"></div>

<footer>
    <a href="https://forms.gle/EQ8bFb1KJLaew9vX7" target="_blank" style="color: var(--harvest-green); font-family: 'Fredoka'; font-size: 12px; font-weight: 700; text-decoration: none; text-transform: uppercase; letter-spacing: 2px;">Update Scholar Profile</a>
</footer>

<script>
    // PROFESSIONAL CSV PARSER: Handles multi-line cells within quotes
    function parseCSV(str) {
        const arr = []; let quote = false;
        for (let row = col = c = 0; c < str.length; c++) {
            let cc = str[c], nc = str[c+1];
            arr[row] = arr[row] || []; arr[row][col] = arr[row][col] || '';
            if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }
            if (cc == '"') { quote = !quote; continue; }
            if (cc == ',' && !quote) { ++col; continue; }
            if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }
            if (cc == '\n' && !quote) { ++row; col = 0; continue; }
            if (cc == '\r' && !quote) { ++row; col = 0; continue; }
            arr[row][col] += cc;
        }
        return arr;
    }

    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHPJe3Zt0F1OO2gt1igtfKLmt4QdMedmq7qI3wn769I-lpWA0aMZ9I07v1DwJgdCuDz2i3t2wPyfmt/pub?output=csv';
    let allData = [];
    let leaders = [];
    let lIdx = 0;

    async function loadGallery() {
        try {
            const res = await fetch(sheetUrl);
            const csvText = await res.text();
            const dataRows = parseCSV(csvText.trim()).slice(1);
            
            allData = dataRows.map(c => {
                if (!c[0] || c[0].trim() === "") return null;
                return { 
                    name: c[0].trim(), 
                    batchNum: c[1].trim(), 
                    accolade: c[2].trim(), 
                    batchName: c[3].trim(), 
                    institution: c[5].trim(), 
                    breaks: parseInt(c[6]) || 0,
                    tournaments: c[7] ? c[7].trim() : ""
                };
            }).filter(i => i !== null);
            render();
        } catch (e) { console.error("Error:", e); }
    }

    function render() {
        const gal = document.getElementById('gallery');
        const nav = document.getElementById('batchNav');
        gal.innerHTML = ""; nav.innerHTML = ""; 

        const batches = [...new Set(allData.map(i => i.batchNum))].sort((a,b) => a-b);
        batches.forEach(bNum => {
            const bItems = allData.filter(i => i.batchNum === bNum);
            const bName = bItems[0].batchName || `Batch ${bNum}`;
            const bID = `batch-${bNum}`;

            nav.innerHTML += `<a href="#${bID}" class="nav-btn">${bName}</a>`;
            const section = document.createElement('div');
            section.className = 'cohort-section'; section.id = bID;
            section.innerHTML = `<div class="cohort-title">ðŸŒ¾ ${bName} ðŸŒ¾</div><div class="grid"></div>`;
            const grid = section.querySelector('.grid');
            
            bItems.forEach((item) => {
                let tourneyHtml = "";
                if (item.tournaments) {
                    const listItems = item.tournaments.split(/\r?\n|,/)
                        .filter(t => t.trim() !== "")
                        .map(t => `<li>${t.trim()}</li>`)
                        .join('');
                    
                    tourneyHtml = `
                        <div class="harvest-dropdown">
                            <span class="dropdown-title">Harvest Log</span>
                            <ul class="tournament-list">${listItems}</ul>
                        </div>
                        <span>ðŸ“‹</span>
                    `;
                }

                grid.innerHTML += `
                    <div class="scholar-card">
                        ${item.breaks > 0 ? `<div class="break-badge">${item.breaks} Breaks ${tourneyHtml}</div>` : ''}
                        <div style="font-size:32px; margin-bottom:10px;">${item.breaks > 0 ? 'ðŸŒ¾' : 'ðŸŒ±'}</div>
                        <span class="name">${item.name}</span>
                        <span class="inst">${item.institution}</span>
                        <div class="accolade-box">${item.accolade}</div>
                    </div>`;
            });
            gal.appendChild(section);
        });

        setTimeout(() => {
            const obs = new IntersectionObserver((es) => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('sprouted') }), {threshold:0.1});
            document.querySelectorAll('.scholar-card').forEach(c => obs.observe(c));
        }, 100);

        const maxB = Math.max(...allData.map(x => x.breaks));
        leaders = allData.filter(s => s.breaks === maxB && maxB > 0);
        if(leaders.length) startLeaderCycle();
    }

    function startLeaderCycle() {
        const el = document.getElementById('leaderName');
        const cycle = () => {
            el.classList.add('fade-out');
            setTimeout(() => {
                lIdx = (lIdx + 1) % leaders.length;
                el.innerText = `Top Harvest: ${leaders[lIdx].name} (${leaders[lIdx].breaks} Breaks)`;
                el.classList.remove('fade-out');
            }, 1200); 
        };
        setInterval(cycle, 5500);
        el.innerText = `Top Harvest: ${leaders[0].name} (${leaders[0].breaks} Breaks)`;
    }

    function searchScholars() {
        const t = document.getElementById('scholarSearch').value.toLowerCase();
        document.querySelectorAll('.scholar-card').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(t) ? 'flex' : 'none';
        });
    }

    loadGallery();
</script>
</body>
</html>
